<!DOCTYPE html>
<html lang="en">
<head>
    <title>Warhammer40k</title>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <header class="main-header">
        <h1>Warhammer 40k</h1>
        <nav>
            <ul>
                <li><a href="index.html">Home</a></li>
                <li><a href="map.html">Map</a></li>
                <li><a href="overlay.html">Overlay</a></li>
                <li><a href="combined.html">Combined</a></li>
                
            </ul>
        </nav>
    </header>

    <h2 class="section-title">Select a Mission Map</h2>
    <select id="mySelect" onchange="updateUnits()">
        <option value="">Select</option>
        <option value="1">GW 2025-26</option>
        <option value="2">WTC 2025</option>
    </select>

    <h2 class="section-title">Deployment</h2>
    <select id="deploymentSelect" onchange="updateLayout()">
        <option value="">Select Deployment</option>
    </select>

    <h2 class="section-title">Layout</h2>
    <select id="layoutSelect" onchange="updateImage()">
        <option value="">Select Layout</option>
    </select>

    <!-- Optional Image Element to Show Selected Map -->
    <img id="image" src="GW Layouts 2025-2026\GW - Tipping Point - Layout 4.png" style="width:100%; display:block; margin-top:20px;"/>
    
    <script>
    const unitOptions = {
        1: ["Tipping Point", "Sweeping Engagement", "Hammer & Anvil", "Dawn of War", "Crucible of Battle"],
        2: ["search and destroy", "tipping point", "sweeping engagement", "hammer & anvil", "dawn of war", "crucible of battle"]
    };

    const layoutOptions = {
        "tipping point": ["Layout 1", "Layout 2", "Layout 4", "Layout 6", "Layout 7", "Layout 8"],
        "sweeping engagement": ["Layout 3", "Layout 5"],
        "hammer & anvil": ["Layout 1", "Layout 7", "Layout 8"],
        "dawn of war": ["Layout 5"],
        "crucible of battle": ["Layout 1", "Layout 2", "Layout 4", "Layout 6", "Layout 8"],

        // If you use WTC values, add entries like:
        // "drone": [...], "medic": [...], etc.
    };

    const layoutOptions2 = {
        "search and destroy": ["1", "2", "3", "4 - 5", "6", "7", "8"],
        "tipping point": ["1", "2", "4 - 5", "6", " 7", "8"],
        "sweeping engagement": ["1", "2", "3", "4 BETA", "5 BETA", "6 BETA"],
        "hammer & anvil": ["1", "2", "3", "4 - 5", "6", "7", "8"],
        "dawn of war": ["1", "2", "3", "4 BETA", "5 BETA", " 6 BETA"],
        "crucible of battle": ["1", "2", "3", "4 - 5", "7", "8"],

        // If you use WTC values, add entries like:
        // "drone": [...], "medic": [...], etc.
    };

    function updateUnits() {
        const armySelect = document.getElementById("mySelect");
        const unitSelect = document.getElementById("deploymentSelect");
        const selectedArmy = armySelect.value;

        unitSelect.innerHTML = '<option value="">-- Select Deployment --</option>';
        document.getElementById("layoutSelect").innerHTML = '<option value="">-- Select Layout --</option>';

        if (unitOptions[selectedArmy]) {
            unitOptions[selectedArmy].forEach(unit => {
                const option = document.createElement("option");
                option.value = unit.toLowerCase(); // This will match layoutOptions keys
                option.text = unit;
                unitSelect.appendChild(option);
            });
        }
    }

    function updateLayout() {
        // gets the selected deployment dropdown
        const deploymentSelect = document.getElementById("deploymentSelect");
        // gets the layout dropdown
        const layoutSelect = document.getElementById("layoutSelect");
        // gets the selected deployment value
        const selectedDeployment = deploymentSelect.value;
        // gets the selected mission map
        const map = document.getElementById("mySelect").value;
        
        // clears the layout dropdown
        layoutSelect.innerHTML = '<option value="">-- Select Layout --</option>';
        
        if (map == "1") {
            // If the map is "GW 2025-26", use the first set of
            if (layoutOptions[selectedDeployment]) {
                layoutOptions[selectedDeployment].forEach(layout => {
                    const option = document.createElement("option");
                    option.value = layout;
                    option.text = layout;
                    layoutSelect.appendChild(option);
                });
            }
        } else if (map == "2") {
            // If the map is "WTC 2025", use the second set of
            // If you want to use the second set of layout options based on a different selection
            if (layoutOptions2[selectedDeployment]) {
                layoutOptions2[selectedDeployment].forEach(layout => {
                    const option = document.createElement("option");
                    option.value = layout;
                    option.text = layout;
                    layoutSelect.appendChild(option);
                });
            }
    }
}
    

    const bc = new BroadcastChannel("overlay_channel");

    // updates the image based on the mission map, deployment, and layout selected
function updateImage() {
    // gets the selected mission map
    const map = document.getElementById("mySelect").value;
    // gets the selected deployment
    const deployment = document.getElementById("deploymentSelect").value;
    // gets the selected layout
    const layout = document.getElementById("layoutSelect").value;
    if (map == "1") {
        // If the map is "GW 2025-26", use the first set of
        if (deployment && layout) {
            const imagePath = `GW Layouts 2025-2026/GW - {deployment} - {layout}.png`.replace("{deployment}", deployment).replace("{layout}", layout);
            localStorage.setItem("overlayImagePath", imagePath);

            document.getElementById("image").src = imagePath;

            // Broadcast to the overlay
            bc.postMessage({ imagePath });
            console.log("Broadcasting image update:", imagePath);
        }
} else if (map == "2") {
        // If the map is "WTC 2025", use the second set of
        if (deployment && layout) {
            // Convert deployment to uppercase for consistency
        const deploymentUpper = deployment.toUpperCase();

            const imagePath = `WTC Layouts 2025/Cards with text/{deployment} - {layout}.png`.replace("{deployment}", deploymentUpper).replace("{layout}", layout);
            localStorage.setItem("overlayImagePath", imagePath);
    
            document.getElementById("image").src = imagePath;

            // Broadcast to the overlay
            bc.postMessage({ imagePath });
            console.log("Broadcasting image update:", imagePath);
        }
    }
}
    </script>
    <style>
.map-container {
    position: relative;
    display: inline-block;
}
.map-image {
    display: block;
    max-width: 100%;
}
.marker {
    position: absolute;
    width: 20px;
    height: 20px;
    background: rgba(0, 255, 0, 0.6);
    border-radius: 50%;
    cursor: pointer;
    transform: translate(-50%, -50%);
}
.piece {
    position: absolute;
    width: 30px;
    height: 30px;
    transform: translate(-50%, -50%);
    pointer-events: none; /* pieces won't block marker clicks */
}
</style>

<div class="map-container" id="mapContainer">
<img src="GW Layouts 2025-2026/GW - Tipping Point - Layout 4.png" class="map-image" id="mapImage">

<!-- Fixed marker locations -->
<div class="marker" style="top: 30%; left: 40%;" data-id="1"></div>
<div class="marker" style="top: 60%; left: 70%;" data-id="2"></div>
</div>

<script>
const mapContainer = document.getElementById("mapContainer");

  // Click only on predefined markers
mapContainer.addEventListener("click", function(e) {
    if (e.target.classList.contains("marker")) {
    const marker = e.target;

    const piece = document.createElement("img");
      piece.src = "piece.png"; // replace with your piece image
    piece.classList.add("piece");

      // Position piece exactly where marker is
    piece.style.top = marker.style.top;
    piece.style.left = marker.style.left;

    mapContainer.appendChild(piece);
    }
});
</script>


</body>
</html>
