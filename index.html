<!DOCTYPE html>
<html lang="en">
<head>
    <title>Warhammer40k</title>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <header class="main-header">
        <h1>Warhammer 40k</h1>
        <nav>
            <ul>
                <li><a href="index.html">Home</a></li>
                <li><a href="map.html">Map</a></li>
                
                
            </ul>
        </nav>
    </header>

    <h2 class="section-title">Select a Mission Map</h2>
    <select id="mySelect" onchange="updateUnits()">
        <option value="">Select</option>
        <option value="1">GW 2025-26</option>
        <option value="2">WTC 2025</option>
    </select>

    <h2 class="section-title">Deployment</h2>
    <select id="deploymentSelect" onchange="updateLayout()">
        <option value="">Select Deployment</option>
    </select>

    <h2 class="section-title">Layout</h2>
    <select id="layoutSelect" onchange="updateImage()">
        <option value="">Select Layout</option>
    </select>

    
    <!-- Making the box for the army list -->
    <div id="ArmyList">
        <div class="labels">
        <h1>Player 1</h1>
        <h2>Army List</h2>
        </div>
        
        <!-- Army selection view -->
        <div id="armySelectionView1">
            <div class="checks" id="checkboxContainer1">
                <!-- Army checkboxes will be generated here -->
            </div>
        </div>

        <!-- Army detail view -->
        <div id="armyDetailView1" style="display: none;">
            <h3 id="armyTitle1"></h3>
            <div id="unitList1">
                <!-- Units for this army -->
            </div>
            <button id="addUnitBtn1">Add Unit</button>
            <button id="deleteUnitBtn1">Delete Unit</button>
            <button id="rotateUnitBtn1">Rotate Unit</button>
            <button id="backBtn1">Back</button>
        </div>
    </div>

    <div id="ArmyList2">
        <div class="labels">
        <h1>Player 2</h1>
        <h2>Army List</h2>
        </div>
        
        <!-- Army selection view -->
        <div id="armySelectionView2">
            <div class="checks" id="checkboxContainer2">
                <!-- Army checkboxes will be generated here -->
            </div>
        </div>

        <!-- Army detail view -->
        <div id="armyDetailView2" style="display: none;">
            <h3 id="armyTitle2"></h3>
            <div id="unitList2">
                <!-- Units for this army -->
            </div>
            <button id="addUnitBtn2">Add Unit</button>
            <button id="deleteUnitBtn2">Delete Unit</button>
            <button id="rotateUnitBtn2">Rotate Unit</button>
            <button id="backBtn2">Back</button>
        </div>
    </div>

    <!-- Optional Image Element to Show Selected Map -->
    <img id="image" src="GW Layouts 2025-2026\GW - Tipping Point - Layout 4.png" style="width:100%; display:block; margin-top:20px;"/>
    
    <script>
    const unitOptions = {
        1: ["Tipping Point", "Sweeping Engagement", "Hammer & Anvil", "Dawn of War", "Crucible of Battle"],
        2: ["search and destroy", "tipping point", "sweeping engagement", "hammer and anvil", "dawn of war", "crucible of battle"]
    };

    const layoutOptions = {
        "tipping point": ["Layout 1", "Layout 2", "Layout 4", "Layout 6", "Layout 7", "Layout 8"],
        "sweeping engagement": ["Layout 3", "Layout 5"],
        "hammer & anvil": ["Layout 1", "Layout 7", "Layout 8"],
        "dawn of war": ["Layout 5"],
        "crucible of battle": ["Layout 1", "Layout 2", "Layout 4", "Layout 6", "Layout 8"],

        // If you use WTC values, add entries like:
        // "drone": [...], "medic": [...], etc.
    };

    const layoutOptions2 = {
        "search and destroy": ["1", "2", "3", "4 - 5", "6", "7", "8"],
        "tipping point": ["1", "2", "3", "4 - 5", "6", "7", "8"],
        "sweeping engagement": ["1", "2", "3", "4 BETA", "5 BETA", "6 BETA"],
        "hammer and anvil": ["1", "2", "3", "4 - 5", "6", "7", "8"],
        "dawn of war": ["1", "2", "3", "4 BETA", "5 BETA", "6 BETA"],
        "crucible of battle": ["1", "2", "3", "4 - 5", "7", "8"],

        // If you use WTC values, add entries like:
        // "drone": [...], "medic": [...], etc.
    };

    function updateUnits() {
        const armySelect = document.getElementById("mySelect");
        const unitSelect = document.getElementById("deploymentSelect");
        const selectedArmy = armySelect.value;

        unitSelect.innerHTML = '<option value="">-- Select Deployment --</option>';
        document.getElementById("layoutSelect").innerHTML = '<option value="">-- Select Layout --</option>';

        if (unitOptions[selectedArmy]) {
            unitOptions[selectedArmy].forEach(unit => {
                const option = document.createElement("option");
                option.value = unit.toLowerCase(); // This will match layoutOptions keys
                option.text = unit;
                unitSelect.appendChild(option);
            });
        }
    }

    function updateLayout() {
        // gets the selected deployment dropdown
        const deploymentSelect = document.getElementById("deploymentSelect");
        // gets the layout dropdown
        const layoutSelect = document.getElementById("layoutSelect");
        // gets the selected deployment value
        const selectedDeployment = deploymentSelect.value;
        // gets the selected mission map
        const map = document.getElementById("mySelect").value;
        
        // clears the layout dropdown
        layoutSelect.innerHTML = '<option value="">-- Select Layout --</option>';
        
        if (map == "1") {
            // If the map is "GW 2025-26", use the first set of
            if (layoutOptions[selectedDeployment]) {
                layoutOptions[selectedDeployment].forEach(layout => {
                    const option = document.createElement("option");
                    option.value = layout;
                    option.text = layout;
                    layoutSelect.appendChild(option);
                });
            }
        } else if (map == "2") {
            // If the map is "WTC 2025", use the second set of
            // If you want to use the second set of layout options based on a different selection
            if (layoutOptions2[selectedDeployment]) {
                layoutOptions2[selectedDeployment].forEach(layout => {
                    const option = document.createElement("option");
                    option.value = layout;
                    option.text = layout;
                    layoutSelect.appendChild(option);
                });
            }
    }
}
    

    const bc = new BroadcastChannel("overlay_channel");

    // updates the image based on the mission map, deployment, and layout selected
function updateImage() {
    // gets the selected mission map
    const map = document.getElementById("mySelect").value;
    // gets the selected deployment
    const deployment = document.getElementById("deploymentSelect").value;
    // gets the selected layout
    const layout = document.getElementById("layoutSelect").value;
    if (map == "1") {
        // If the map is "GW 2025-26", use the first set of
        if (deployment && layout) {
            const imagePath = `GW Layouts 2025-2026/GW - {deployment} - {layout}.png`.replace("{deployment}", deployment).replace("{layout}", layout);
            
            // Save to localStorage for overlay page
            localStorage.setItem("overlayImagePath", imagePath);

            document.getElementById("image").src = imagePath;

            // Broadcast to the overlay
            bc.postMessage({ imagePath });
            console.log("Broadcasting image update:", imagePath);
        }
} else if (map == "2") {
        // If the map is "WTC 2025", use the second set of
        if (deployment && layout) {
            // Convert deployment to uppercase for consistency
        const deploymentUpper = deployment.toUpperCase();

            const imagePath = `WTC Layouts 2025/Cards with text/{deployment} - {layout}.png`.replace("{deployment}", deploymentUpper).replace("{layout}", layout);
            
            // Save to localStorage for overlay page
            localStorage.setItem("overlayImagePath", imagePath);
    
            document.getElementById("image").src = imagePath;

            // Broadcast to the overlay
            bc.postMessage({ imagePath });
            console.log("Broadcasting image update:", imagePath);
        }
    }
}
    </script>


<div class="map-container" id="mapContainer">
<img src="GW Layouts 2025-2026/GW - Tipping Point - Layout 4.png" class="map-image" id="mapImage">

<!-- Fixed marker locations -->
<div class="marker" style="top: 30%; left: 40%;" data-id="1"></div>
<div class="marker" style="top: 60%; left: 70%;" data-id="2"></div>
</div>

<script>
const mapContainer = document.getElementById("mapContainer");

  // Click only on predefined markers
mapContainer.addEventListener("click", function(e) {
    if (e.target.classList.contains("marker")) {
    const marker = e.target;

    const piece = document.createElement("img");
      piece.src = "piece.png"; // replace with your piece image
    piece.classList.add("piece");

      // Position piece exactly where marker is
    piece.style.top = marker.style.top;
    piece.style.left = marker.style.left;

    mapContainer.appendChild(piece);
    }
});
</script>

<script>
    // Army list data
    const armyList = [
        "Space Marines", "Ultra Marines", "Imperial Fists", "Iron Hands", "Raven Guard",
        "Salamanders", "White Scars", "Genestealer Cults", "Tyranids", "Necrons",
        "Thousand Sons", "Space Wolves", "Dark Angels", "Black Templars", "Blood Angels",
        "Death Guard", "Chaos Demons", "Chaos Knights", "Adeptus Sororitas", "Adeptus Mechanicus",
        "Deathwatch", "Chaos Space Marines", "World Eaters", "Orks", "Aeldari",
        "Grey Knights", "Tau", "Votann", "Imperial Knights", "Drukhari",
        "Imperial Guard", "Custodes"
    ];

    // Army management
    const armies = {
        player1: {},
        player2: {}
    };

    // Initialize armies
    armyList.forEach(army => {
        armies.player1[army] = [];
        armies.player2[army] = [];
    });

    // Generate army checkboxes for both players
    function generateArmyCheckboxes() {
        const container1 = document.getElementById('checkboxContainer1');
        const container2 = document.getElementById('checkboxContainer2');
        
        armyList.forEach((army, index) => {
            // Player 1
            const label1 = document.createElement('label');
            const checkbox1 = document.createElement('input');
            checkbox1.type = 'checkbox';
            checkbox1.id = `army1_${index + 1}`;
            checkbox1.value = army;
            checkbox1.addEventListener('change', () => handleArmySelection(1, army, checkbox1));
            label1.appendChild(checkbox1);
            label1.appendChild(document.createTextNode(army));
            container1.appendChild(label1);

            // Player 2
            const label2 = document.createElement('label');
            const checkbox2 = document.createElement('input');
            checkbox2.type = 'checkbox';
            checkbox2.id = `army2_${index + 1}`;
            checkbox2.value = army;
            checkbox2.addEventListener('change', () => handleArmySelection(2, army, checkbox2));
            label2.appendChild(checkbox2);
            label2.appendChild(document.createTextNode(army));
            container2.appendChild(label2);
        });
    }

    // Handle army selection
    function handleArmySelection(player, armyName, checkbox) {
        const playerKey = `player${player}`;
        const hasUnits = armies[playerKey][armyName].length > 0;
        
        // If army has units, keep checkbox checked and open detail view
        if (hasUnits) {
            checkbox.checked = true;
            openArmyDetail(player, armyName);
        } else if (checkbox.checked) {
            // If no units and checkbox is checked, open detail view
            openArmyDetail(player, armyName);
        }
        // If no units and checkbox is unchecked, do nothing (allow unchecking empty armies)
    }

    // Open army detail view
    function openArmyDetail(player, armyName) {
        const selectionView = document.getElementById(`armySelectionView${player}`);
        const detailView = document.getElementById(`armyDetailView${player}`);
        const armyTitle = document.getElementById(`armyTitle${player}`);

        selectionView.style.display = 'none';
        detailView.style.display = 'block';
        armyTitle.textContent = armyName;
        renderUnits(player, armyName);
    }

    // Render units for an army
    function renderUnits(player, armyName) {
        const unitList = document.getElementById(`unitList${player}`);
        const playerKey = `player${player}`;
        
        unitList.innerHTML = '';
        armies[playerKey][armyName].forEach(unit => {
            const div = document.createElement('div');
            div.textContent = unit;
            unitList.appendChild(div);
        });
    }

    // Add unit
    function addUnit(player, armyName) {
        const playerKey = `player${player}`;
        const unitCount = armies[playerKey][armyName].length + 1;
        armies[playerKey][armyName].push(`Unit ${unitCount}`);
        renderUnits(player, armyName);
        
        // Keep the checkbox checked since army now has units
        updateCheckboxState(player, armyName, true);
    }

    // Delete last unit
    function deleteLastUnit(player, armyName) {
        const playerKey = `player${player}`;
        armies[playerKey][armyName].pop();
        renderUnits(player, armyName);
        
        // Update checkbox state based on whether army still has units
        const hasUnits = armies[playerKey][armyName].length > 0;
        updateCheckboxState(player, armyName, hasUnits);
    }

    // Update checkbox state
    function updateCheckboxState(player, armyName, checked) {
        const checkboxes = document.querySelectorAll(`#checkboxContainer${player} input[value="${armyName}"]`);
        checkboxes.forEach(checkbox => {
            checkbox.checked = checked;
        });
    }

    // Go back to army selection
    function goBackToSelection(player) {
        const selectionView = document.getElementById(`armySelectionView${player}`);
        const detailView = document.getElementById(`armyDetailView${player}`);
        
        selectionView.style.display = 'block';
        detailView.style.display = 'none';
    }

    // Event listeners for buttons
    document.getElementById('addUnitBtn1').addEventListener('click', () => {
        const armyName = document.getElementById('armyTitle1').textContent;
        addUnit(1, armyName);
    });

    document.getElementById('deleteUnitBtn1').addEventListener('click', () => {
        const armyName = document.getElementById('armyTitle1').textContent;
        deleteLastUnit(1, armyName);
    });

    document.getElementById('rotateUnitBtn1').addEventListener('click', () => {
        alert('Rotate functionality would be implemented here');
    });

    document.getElementById('backBtn1').addEventListener('click', () => {
        goBackToSelection(1);
    });

    document.getElementById('addUnitBtn2').addEventListener('click', () => {
        const armyName = document.getElementById('armyTitle2').textContent;
        addUnit(2, armyName);
    });

    document.getElementById('deleteUnitBtn2').addEventListener('click', () => {
        const armyName = document.getElementById('armyTitle2').textContent;
        deleteLastUnit(2, armyName);
    });

    document.getElementById('rotateUnitBtn2').addEventListener('click', () => {
        alert('Rotate functionality would be implemented here');
    });

    document.getElementById('backBtn2').addEventListener('click', () => {
        goBackToSelection(2);
    });

    // Initialize the application
    document.addEventListener('DOMContentLoaded', function() {
        generateArmyCheckboxes();
    });
</script>

</body>
</html>