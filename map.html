<!DOCTYPE html>
    <html lang = "en">
    <head>
        <title>Warhammer40k - Image</title>
        <meta charset="UTF-8">
        <link rel="stylesheet" href="styles.css">
    </head>

<style>
    html, body {
    margin: 0;
    padding: 0;
    background: transparent;
    overflow: hidden;
    height: 100%;
    width: 100%;
    }

    #map {
    width: 100vw;
    height: 100vh;
      object-fit: contain; /* Use "contain" if you want to maintain aspect ratio with borders */
    display: block;
    }
</style>
</head>
<body>
    <img id="image" src="http://localhost:5500/GW%20Layouts%202025-2026/GW%20-%20Crucible%20of%20Battle%20-%20Layout%202.png" style="width:100vw; height:100vh; object-fit:contain;" alt="Test Image">
    
    <div id="checkboxContainer">    </div>
    

    <script>
        // Function to create checkboxes based on the image path
        const checkboxData = {
    "GW - Tipping Point - Layout 4.png": ["Army 1", "Army 2", "Army 3"],
    "GW - Crucible of Battle - Layout 2.png": ["Alpha Squad", "Bravo Squad", "Charlie Squad"],
    "WTC - Search and Destroy - Layout 1.png": ["Unit A", "Unit B", "Unit C"],
    "WTC - Tipping Point - Layout 2.png": ["Unit X", "Unit Y", "Unit Z"]
};
        function updateImageFromServer() {
    fetch("/current-image")
        .then(res => res.json())
        .then(data => {
            const path = data.imagePath;
            if (path && img.src !== path) {
                img.src = `${path}?t=${Date.now()}`; // force reload
            }
        });
}

setInterval(updateImageFromServer, 1000);

const img = document.getElementById("image");

    function updateImageFromStorage() {
        const rawPath = localStorage.getItem("overlayImagePath");

        if (rawPath) {
            // Cache-busting timestamp to force reload
            const cacheBusted = `${rawPath}?t=${Date.now()}`;

            if (img.src !== cacheBusted) {
                img.src = cacheBusted;
                img.alt = `Overlay map: ${rawPath}`;
                console.log("OBS overlay image updated:", cacheBusted);
            }
        }
    }



    const checkboxContainer = document.getElementById("checkboxContainer");

function loadCheckboxesForMap(mapFileName) {
    checkboxContainer.innerHTML = ""; // Clear old checkboxes

    if (checkboxData[mapFileName]) {
    checkboxData[mapFileName].forEach((labelText, index) => {
        const checkboxId = `checkbox_${index}`;

        const checkbox = document.createElement("input");
        checkbox.type = "checkbox";
        checkbox.id = checkboxId;
        checkbox.checked = true;

        const label = document.createElement("label");
        label.htmlFor = checkboxId;
        label.innerText = labelText;

        checkboxContainer.appendChild(checkbox);
        checkboxContainer.appendChild(label);
        checkboxContainer.appendChild(document.createElement("br"));
    });
    }
}

  // When your image updates from localStorage or fetch
function updateImageFromStorage() {
    const rawPath = localStorage.getItem("overlayImagePath");

    if (rawPath) {
      const fileName = rawPath.split("/").pop(); // Extract filename only
    const cacheBusted = `${rawPath}?t=${Date.now()}`;

    if (img.src !== cacheBusted) {
        img.src = cacheBusted;
        img.alt = `Overlay map: ${rawPath}`;
        console.log("OBS overlay image updated:", cacheBusted);

        // Load checkboxes for this map
        loadCheckboxesForMap(fileName);
    }
    } }

  // Initial load
updateImageFromStorage();
setInterval(updateImageFromStorage, 1000);


</script>
<style>
.map-container {
    position: relative;
    display: inline-block;
}
.map-image {
    display: block;
    max-width: 100%;
}
.marker {
    position: absolute;
    width: 20px;
    height: 20px;
    background: rgba(0, 255, 0, 0.6);
    border-radius: 50%;
    cursor: pointer;
    transform: translate(-50%, -50%);
}
.piece {
    position: absolute;
    width: 30px;
    height: 30px;
    transform: translate(-50%, -50%);
    pointer-events: none; /* pieces won't block marker clicks */
}
</style>

<div class="map-container" id="mapContainer">
<img src="GW Layouts 2025-2026/GW - Tipping Point - Layout 4.png" class="map-image" id="mapImage">

<!-- Fixed marker locations -->
<div class="marker" style="top: 30%; left: 40%;" data-id="1"></div>
<div class="marker" style="top: 60%; left: 70%;" data-id="2"></div>
</div>



</body>
</html>